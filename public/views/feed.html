<!DOCTYPE html>
<html>

<head>
    <title>ReFrame - Feed</title>
    <meta charset="utf-8" />
    <style type="text/css">
    </style>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src='/socket.io/socket.io.js'></script>
    <script src="../js/createAccount.js"></script>

    <link rel="stylesheet" href="../css/feed.css">
</head>

<body>
    
    <aside>
      <div class="menu-div">
        <nav class="menu">
          <a href="/createPost" id="new-post-link">Create Post</a>
        </nav>
      </div>
    </aside>
    
    <div id="feed"></div>
    

    <script>
        //let accountSystem = require('./createAccount')
        
        const socket = io();
          postIndex = 0;
          socket.on('post-to-feed', (caption, image)=>{

              let feed = $('#feed');
              let postContainer = `<div id="post-${postIndex}" class="post-container">
                                     
                                      <img src="${image}" id="post-image-${postIndex}" height="auto" width="80%" class="post-image">
                                      <p id="post-caption-${postIndex}">${caption}</p>
                                    
                                  </div>`
               
    
                feed.prepend(postContainer);
               
            postIndex++;
          })
          function populateFeed(){
            let feed = $('#feed');
            $.get('/populate-feed', (data)  =>{
              let allPost = data.allPost;
              for(i = 0; i<allPost.length; i++){
                let image = allPost[i].image;
                let caption = allPost[i].caption;
                let postContainer2 = `<div id="post-${postIndex}" class="post-container">
                                      
                                      <img src="${image}" id="post-image-${postIndex}" height="auto" width="80%"  class="post-image">
                                      <p id="post-caption-${postIndex}">${caption}</p>
                                      
                                    
                                  </div>`
                feed.prepend(postContainer2);
                postIndex++;
              }
            })
          }
          function createNewPost(){
            window.location.replace('/createPost');
          }
          $(document).ready(()=>{
            
            populateFeed();
          })
    </script>

</body>

</html>