<!DOCTYPE html>
<html>
  <head>
    <title>Home Page</title>
    <meta charset="utf-8"/>
    <style type="text/css">

    </style>
     <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
     <script src='/socket.io/socket.io.js'></script>
  </head>
  <body>
        <a id="create-post-link" href='/createPost'>Create Post</a>
      <div id="feed"></div>

     

    <script>
      const socket = io();
      postIndex = 0;
      socket.on('post-to-feed', (caption, image)=>{

          let feed = $('#feed');
          let postContainer = `<div id="post-${postIndex}">
                                <fieldset>
                                  <img src="${image}" id="post-image-${postIndex}" height="300" width="300">
                                  <p id="post-caption-${postIndex}">${caption}</p>
                                </fieldset>
                              </div>`
           

            feed.prepend(postContainer);
           
        postIndex++;
      })
      function populateFeed(){
        let feed = $('#feed');
        $.get('/populate-feed', (data)  =>{
          let allPost = data.allPost;
          for(i = 0; i<allPost.length; i++){
            let image = allPost[i].image;
            let caption = allPost[i].caption;
            let postContainer2 = `<div id="post-${postIndex}">
                                <fieldset>
                                  <img src="${image}" id="post-image-${postIndex}" height="300" width="300">
                                  <p id="post-caption-${postIndex}">${caption}</p>
                                </fieldset>
                              </div>`
            feed.prepend(postContainer2);
            postIndex++;
          }
        })
      }
      $(document).ready(()=>{
        populateFeed();
      })
    </script>
    

  </body>
</html>